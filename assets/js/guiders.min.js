/**
 * guiders.js
 *
 * version 2.0.0
 *
 * Released under the Apache License 2.0.
 * www.apache.org/licenses/LICENSE-2.0.html
 *
 * Questions about Guiders?
 * Email me (Jeff Pickhardt) at pickhardt@gmail.com
 *
 * Questions about Optimizely? Email one of the following:
 * sales@optimizely.com or support@optimizely.com
 *
 * Enjoy!
 */
var guiders=function(e){var t=e.guiders={};t.version="2.0.0";t._defaultSettings={attachTo:null,autoFocus:false,buttons:[{name:"Close"}],buttonCustomHTML:"",classString:null,closeOnEscape:false,description:"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",highlight:null,isHashable:true,maxWidth:null,offset:{top:null,left:null},onClose:null,onHide:null,onShow:null,overlay:false,position:0,shouldSkip:function(){},title:"Sample title goes here",width:400,xButton:false};t._htmlSkeleton=["<div class='guider'>","  <div class='guiders_content'>","    <h1 class='guiders_title'></h1>","    <div class='guiders_close'></div>","    <p class='guiders_description'></p>","    <div class='guiders_buttons_container'>","    </div>","  </div>","  <div class='guiders_arrow'>","  </div>","</div>"].join("");t._arrowSize=42;t._backButtonTitle="Back";t._buttonAttributes={href:"javascript:void(0);"};t._buttonClassName="guiders_button";t._buttonClickEvent="click touch";t._buttonElement="<a></a>";t._closeButtonTitle="Close";t._currentGuiderID=null;t._fixedOrAbsolute="fixed";t._guiders={};t._lastCreatedGuiderID=null;t._nextButtonTitle="Next";t._offsetNameMapping={topLeft:11,top:12,topRight:1,rightTop:2,right:3,rightBottom:4,bottomRight:5,bottom:6,bottomLeft:7,leftBottom:8,left:9,leftTop:10};t._windowHeight=0;var n=navigator.userAgent.match(/MSIE\s([\d.]+)/);t._isIE=n&&n.length>1;t._ieVersion=n&&n.length>1?Number(n[1]):-1;t._addButtons=function(n){var r=n.elem.find(".guiders_buttons_container");if(n.buttons===null||n.buttons.length===0){r.remove();return}for(var i=n.buttons.length-1;i>=0;i--){var s=n.buttons[i];var o=e(t._buttonElement,e.extend({"class":t._buttonClassName,html:s.name},t._buttonAttributes,s.html||{}));if(typeof s.classString!=="undefined"&&s.classString!==null){o.addClass(s.classString)}r.append(o);var u=s.name.toLowerCase();if(s.onclick){o.bind(t._buttonClickEvent,s.onclick)}else{switch(u){case t._closeButtonTitle.toLowerCase():o.bind(t._buttonClickEvent,function(){t.hideAll();if(n.onClose){n.onClose(n,false)}e("body").trigger("guidersClose")});break;case t._nextButtonTitle.toLowerCase():o.bind(t._buttonClickEvent,function(){!n.elem.data("locked")&&t.next()});break;case t._backButtonTitle.toLowerCase():o.bind(t._buttonClickEvent,function(){!n.elem.data("locked")&&t.prev()});break}}}if(n.buttonCustomHTML!==""){var a=e(n.buttonCustomHTML);n.elem.find(".guiders_buttons_container").append(a)}if(n.buttons.length===0){r.remove()}};t._addXButton=function(n){var r=n.elem.find(".guiders_close");var i=e("<div></div>",{"class":"guiders_x_button",role:"button"});r.append(i);i.click(function(){t.hideAll();if(n.onClose){n.onClose(n,true)}e("body").trigger("guidersClose")})};t._attach=function(n){if(typeof n!=="object"){return}var r=e(n.attachTo);var i=n.elem.innerHeight();var s=n.elem.innerWidth();if(n.position===0||r.length===0){var o="fixed";if(t._isIE&&t._ieVersion<9){o="absolute"}n.elem.css("position",o);n.elem.css("top",(e(window).height()-i)/3+"px");n.elem.css("left",(e(window).width()-s)/2+"px");return}var u=r.offset();var a=u.top;var f=u.left;var l=e("body").outerHeight(true)-e("body").outerHeight(false);a-=l;if(t._offsetNameMapping[n.position]){n.position=t._offsetNameMapping[n.position]}var c=r.innerHeight();var h=r.innerWidth();var p=.9*t._arrowSize;var d={1:[-p-i,h-s],2:[0,p+h],3:[c/2-i/2,p+h],4:[c-i,p+h],5:[p+c,h-s],6:[p+c,h/2-s/2],7:[p+c,0],8:[c-i,-s-p],9:[c/2-i/2,-s-p],10:[0,-s-p],11:[-p-i,0],12:[-p-i,h/2-s/2]};var v=d[n.position];a+=v[0];f+=v[1];var m="absolute";if(r.css("position")==="fixed"&&t._fixedOrAbsolute==="fixed"){m="fixed";a-=e(window).scrollTop();f-=e(window).scrollLeft()}if(n.offset.top!==null){a+=n.offset.top}if(n.offset.left!==null){f+=n.offset.left}t._styleArrow(n);n.elem.css({position:m,top:a,left:f});return n};t._dehighlightElement=function(t){e(t).removeClass("guiders_highlight")};t._hideOverlay=function(){e("#guiders_overlay").fadeOut("fast")};t._highlightElement=function(t){e(t).addClass("guiders_highlight")};t._initializeOverlay=function(){if(e("#guiders_overlay").length===0){e("<div id='guiders_overlay'></div>").hide().appendTo("body")}};t._showOverlay=function(n){e("#guiders_overlay").fadeIn("fast",function(){if(this.style.removeAttribute){this.style.removeAttribute("filter")}});if(t._isIE){e("#guiders_overlay").css("position","absolute")}};t._styleArrow=function(n){var r=n.position||0;if(!r){return}var i=e(n.elem.find(".guiders_arrow"));var s={1:"guiders_arrow_down",2:"guiders_arrow_left",3:"guiders_arrow_left",4:"guiders_arrow_left",5:"guiders_arrow_up",6:"guiders_arrow_up",7:"guiders_arrow_up",8:"guiders_arrow_right",9:"guiders_arrow_right",10:"guiders_arrow_right",11:"guiders_arrow_down",12:"guiders_arrow_down"};i.addClass(s[r]);var o=n.elem.innerHeight();var u=n.elem.innerWidth();var a=t._arrowSize/2;var f={1:["right",a],2:["top",a],3:["top",o/2-a],4:["bottom",a],5:["right",a],6:["left",u/2-a],7:["left",a],8:["bottom",a],9:["top",o/2-a],10:["top",a],11:["left",a],12:["left",u/2-a]};var r=f[n.position];i.css(r[0],r[1]+"px")};t._showIfHashed=function(e){var n="guider=";var r=window.location.hash.indexOf(n);if(r!==-1){var i=window.location.hash.substr(r+n.length);if(e.id.toLowerCase()===i.toLowerCase()){t.show(e.id)}}};t._updatePositionOnResize=function(){var n=undefined;e(window).resize(function(){if(typeof n!=="undefined"){clearTimeout(n)}n=setTimeout(function(){n=undefined;if(typeof t!=="undefined"){t.reposition()}},20)})};t._updatePositionOnResize();t._unwireEscape=function(t){e(document).unbind("keydown")};t._wireEscape=function(n){e(document).keydown(function(r){if(r.keyCode==27||r.which==27){t.hideAll();if(n.onClose){n.onClose(n,true)}e("body").trigger("guidersClose");return false}})};t.createGuider=function(n){if(n===null||n===undefined){n={}}myGuider=e.extend({},t._defaultSettings,n);myGuider.id=myGuider.id||"guider_random_"+String(Math.floor(Math.random()*1e3));var r=e("#"+myGuider.id);if(!r.length){r=e(t._htmlSkeleton)}myGuider.elem=r;if(typeof myGuider.classString!=="undefined"&&myGuider.classString!==null){myGuider.elem.addClass(myGuider.classString)}if(Number(myGuider.width)===myGuider.width){myGuider.width=String(myGuider.width)+"px"}if(Number(myGuider.maxWidth)===myGuider.maxWidth){myGuider.maxWidth=String(myGuider.maxWidth)+"px"}myGuider.elem.css("width",myGuider.width);myGuider.elem.css("maxWidth",myGuider.maxWidth);var i=r.find(".guiders_title");i.html(myGuider.title);r.find(".guiders_description").html(myGuider.description);t._addButtons(myGuider);if(myGuider.xButton){t._addXButton(myGuider)}r.hide();r.appendTo("body");r.attr("id",myGuider.id);if(typeof myGuider.attachTo!=="undefined"&&myGuider!==null){t._attach(myGuider)}t._initializeOverlay();t._guiders[myGuider.id]=myGuider;if(t._lastCreatedGuiderID!=null){myGuider.prev=t._lastCreatedGuiderID}t._lastCreatedGuiderID=myGuider.id;if(myGuider.isHashable){t._showIfHashed(myGuider)}return t};t.get=function(e){if(typeof t._guiders[e]==="undefined"){return null}return t._guiders[e]||null};t.getCurrentGuider=function(){return t._guiders[t._currentGuiderID]||null};t.hideAll=function(n,r){r=r||false;e(".guider:visible").each(function(n,i){var s=t.get(e(i).attr("id"));if(s.onHide){s.onHide(s,r)}});e(".guider").fadeOut("fast");var i=t._guiders[t._currentGuiderID];if(i&&i.highlight){t._dehighlightElement(i.highlight)}if(typeof n!=="undefined"&&n===true){}else{t._hideOverlay()}return t};t.next=function(){var e=t._guiders[t._currentGuiderID];if(typeof e==="undefined"){return null}e.elem.data("locked",true);var n=e.next||null;if(n!==null&&n!==""){var r=t.get(n);var i=r.overlay?true:false;t.hideAll(i,true);if(e&&e.highlight){t._dehighlightElement(e.highlight)}if(r.shouldSkip&&r.shouldSkip()){t._currentGuiderID=r.id;t.next();return t.getCurrentGuider()}else{t.show(n);return t.getCurrentGuider()}}};t.prev=function(){var e=t._guiders[t._currentGuiderID];if(typeof e==="undefined"){return null}if(e.prev===null){return null}var n=t._guiders[e.prev];n.elem.data("locked",true);var r=n.id||null;if(r!==null&&r!==""){var i=t.get(r);var s=i.overlay?true:false;t.hideAll(s,true);if(n&&n.highlight){t._dehighlightElement(n.highlight)}t.show(r);return i}};t.reposition=function(){var e=t._guiders[t._currentGuiderID];t._attach(e)};t.scrollToCurrent=function(){var n=t._guiders[t._currentGuiderID];if(typeof n==="undefined"){return}var r=t._windowHeight;var i=e(window).scrollTop();var s=n.elem.offset();var o=n.elem.height();var u=Math.round(Math.max(s.top+o/2-r/2,0));window.scrollTo(0,u)};t.show=function(n){if(!n&&t._lastCreatedGuiderID){n=t._lastCreatedGuiderID}var r=t.get(n);if(r.overlay){t._showOverlay(r);if(r.highlight&&r.attachTo){t._highlightElement(r.attachTo)}}if(r.closeOnEscape){t._wireEscape(r)}else{t._unwireEscape(r)}if(r.onShow){r.onShow(r)}t._attach(r);r.elem.fadeIn("fast").data("locked",false);t._currentGuiderID=n;var i=t._windowHeight=e(window).height();var s=e(window).scrollTop();var o=r.elem.offset();var u=r.elem.height();var a=s+i<o.top+u;var f=o.top<s;if(r.autoFocus&&(a||f)){setTimeout(t.scrollToCurrent,10)}e(r.elem).trigger("guiders.show");return t};e.fn.guider=function(n){n=n||{};var r=e.extend({},n);r.id=e(this).attr("id");var i=[];e(this).find(".guiders_buttons_container").children().each(function(){var t={name:e(this).html(),classString:e(this).attr("class")};if(e(this).attr("data-onclick")){var n=e(this).attr("data-onclick");t.onclick=function(){window[n]()}}e(this).remove();i.push(t)});r.buttons=i;title=e(this).find(".guiders_title").html();if(title){r.title=title}description=e(this).find(".guiders_description").html();if(description){r.description=description}for(var s in t._defaultSettings){if(!t._defaultSettings.hasOwnProperty(s)){continue}var o=e(this).attr("data-"+s);if(o===undefined||o===null){continue}if(o=="true"){o=true}else if(o=="false"){o=false}r[s]=o}t.createGuider(r);return this};return t}.call(this,jQuery)